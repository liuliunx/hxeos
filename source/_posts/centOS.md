---
title: 国外节点服务器部署
author: liuliuxn
coverImg: /medias/banner/5.jpg
top: false
cover: false
toc: true
mathjax: false
summary: '创建国外centOS服务器,配置节点端口转发'
tags:
  - centOS
  - 服务器系统环境搭建教程
categories:
  - 运维篇
abbrlink: 4b353641
reprintPolicy: cc_by
date: 2020-03-27 00:00:00
img:
password:
---


### 0x01 创建国外centOS服务器

#### 1. 登录服务器

#### 2.查看当前网口
```bash
ifconfig
```
默认是`eth0 `网口

问题 如果不是`eth0`位网口,则配置网口信息
#### 3. 把里面内容的eth1改为eth0
```bash
vi /etc/sysconfig/network-scripts/ifcfg-eth1
```

##### 4. 把里面内容的`eth1`改为`eth0`
```bash
vi /etc/udev/rules.d/70-persistent-net.rules
```

### 0x02 增加基本软件
#### 1. 安装基本软件
```bash
yum install -y dnsmasq
yum install -y wget
yum install -y lzo
yum install -y json-c curl libgtop2
yum install -y unzip zip
yum -y install libpcap
yum -y install json-c
yum -y install gcc
yum -y install autoconf
yum -y install epel-release
yum -y install libsodium
yum -y install GeoIP-devel
yum -y install ntp
yum -y install nload
yum -y install vixie-cron
yum -y install jsoncpp
yum -y install java
yum update -y
```
#### 2.开启路由转发功能

##### 方法1
```bash
\[root@centos6 \~\]# echo 1 \> /proc/sys/net/ipv4/ip_forward
```
##### 方法2
```bash
\[root@centos6 \~\]# vim /etc/sysctl.conf net.ipv4.ip_forward = 0
```
```bash
 net.ipv4.ip_forward = 0   //该行的0改为1即可
 net.ipv4.conf.default.rp_filter = 1
 net.ipv4.conf.default.accept_source_route = 0
 kernel.sysrq = 0
 kernel.core_uses_pid = 1
 net.ipv4.tcp_syncookies = 1
 kernel.msgmnb = 65536
 kernel.msgmax = 65536
 kernel.shmmax = 68719476736
 kernel.shmall = 4294967296
```
```bash
[root@centos6 ~]# sysctl -p   //查看修改结果.
```
#### 3. 注意

修改：`net.ipv4.ip_forward=1`

注意：一般来说，只有一行`net.ipv4.ip_forward`参数，但有些系统特殊可能有两行，如果有两行，要删除一行，只保留一行。

#### 4. 下载节点安装包
```bash
wget -P \"/root/ipcloud\" http://down.fuckip.com/yy/normal_yy.zip
```
#### 5. 目录地址`/root/ipcloud`

#### 6. 解压删除安装包
```bash
unzip -P hhlrzk /root/ipcloud/normal_yy.zip -d /root/ipcloud
unzip /root/ipcloud/node.zip -d /root/ipcloud
unzip /root/ipcloud/kcptun.zip -d /root/ipcloud
rm -rf  /root/ipcloud/*.zip
```
#### 7. 设置启动项文件
```bash
vi /etc/rc.d/rc.local
```
```bash
/root/ipcloud/firewall.sh &
/root/ipcloud/node/node --config /root/ipcloud/node/config.conf >/dev/null 2>&1 &
/root/ipcloud/tun_device --ip 10.31.5.1 >/dev/null 2>&1 &
/root/ipcloud/kcptun/clientserv >/dev/null 2>&1 &
```
#### 8. 安装`dnsmasq`
```bash
rm -rf /etc/dnsmasq.hosts
cp /etc/hosts /etc/dnsmasq.hosts
touch /etc/resolv.dnsmasq.conf
echo 'nameserver 8.8.8.8' > /etc/resolv.dnsmasq.conf
rm -rf /etc/dnsmasq.conf
wget -N -O "/etc/dnsmasq.conf" http://down.fuckip.com/dnsmasqconf.zip
wget -N -O "/etc/logrotate.d/dnsmasq" http://down.fuckip.com/logrotate.dnsmasq.rar
chkconfig dnsmasq on
/etc/init.d/dnsmasq restart
```
### 0x03 修改`ssh`端口 
ssh端口使用 3323 - 5623 之间，随机一个。# 注释关闭22端口
```bash
vim /etc/ssh/sshd_config *#Port 22* Port 端口号
```
### 0x04 放行`ssh`端口
```bash
/etc/sysconfig/iptables
```
### 0x05 修改密码
```bash
passwd
```
### 0x06 清空记录
```bash
echo > .bash_history
history -c
```
history -c
### 0x07 重启
```bash
reboot
```
### 问题总结

下面是发生意外问题的时候解决办法
```bash
/etc/sysconfig/iptables 
```
### Centos 6版本解决办法：

#### 1.任意运行一条`iptables`防火墙规则配置命令：
```bash
iptables -P OUTPUT ACCEPT
```
#### 2.对`iptables`服务进行保存：
```bash
service iptables save  
```
```bash
 Generated by iptables-save v1.4.7 on Wed Dec 21 15:50:24 2016
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [1:140]
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 5647 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
```